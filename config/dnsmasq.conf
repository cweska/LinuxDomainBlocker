# dnsmasq configuration for domain blocking
# This file is managed by the domain-blocker system

# Listen on localhost (both IPv4 and IPv6 if available)
# This allows systemd-resolved and other local services to use dnsmasq
listen-address=127.0.0.1
listen-address=::1
# bind-interfaces is deprecated, use bind-dynamic instead for better compatibility
bind-dynamic

# Don't read /etc/hosts (we use our own block list)
no-hosts

# Don't read /etc/resolv.conf (use upstream DNS servers)
no-resolv

# Use Google DNS as upstream (both IPv4 and IPv6)
server=8.8.8.8
server=8.8.4.4
server=2001:4860:4860::8888
server=2001:4860:4860::8844

# Alternative: Use Cloudflare DNS
# server=1.1.1.1
# server=1.0.0.1
# server=2606:4700:4700::1111
# server=2606:4700:4700::1001

# Cache size (default is 150)
cache-size=10000

# Enable logging (optional, for debugging)
# log-queries
# log-facility=/var/log/dnsmasq.log

# Include the blocked domains configuration
conf-file=/opt/domain-blocker/config/blocked-domains.conf

# Don't read from /etc/dnsmasq.d (we use our own config)
# This prevents permission issues if the directory has wrong permissions
# Note: We don't set conf-dir, so dnsmasq won't automatically read from /etc/dnsmasq.d
# The install script ensures /etc/dnsmasq.d has correct permissions if it exists
# conf-dir=/etc/dnsmasq.d  # Commented out - we use conf-file instead

# Don't poll /etc/resolv.conf for changes
no-poll

# Enable DNSSEC validation
dnssec

# Don't forward private IP ranges
bogus-priv

# Don't forward reverse lookups for private IP ranges
domain-needed

